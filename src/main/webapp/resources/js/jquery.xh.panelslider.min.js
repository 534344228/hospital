(function($) {
	var $body = $("body"), _sliding = false;
	function _slideIn(panel, options) {
		var panelWidth = panel.outerWidth(true), bodyAnimation = {}, panelAnimation = {};
		if (panel.is(":visible") || _sliding) {
			return
		}
		_sliding = true;
		panel.addClass("ps-active-panel").css({
			position : "fixed",
			top : 0,
			height : "100%",
			"z-index" : 0
		});
		panel.data(options);
		switch (options.side) {
		case "left":
			panel.css({
				left : "-" + panelWidth + "px",
				right : "auto"
			});
			bodyAnimation["margin-left"] = "+=" + panelWidth;
			panelAnimation.left = "+=" + panelWidth;
			break;
		case "right":
			panel.css({
				left : "auto",
				right : "-" + panelWidth + "px"
			});
			bodyAnimation["margin-left"] = "-=" + panelWidth;
			panelAnimation.right = "+=" + panelWidth;
			break
		}
		$body.animate(bodyAnimation, options.duration);
		panel.show().animate(panelAnimation, options.duration, function() {
			_sliding = false
		})
	}
	$.panelslider = function(element, options) {
		var active = $(".ps-active-panel");
		var defaults = {
			side : "left",
			duration : 200,
			clickClose : true
		};
		options = $.extend({}, defaults, options);
		if (active.is(":visible") && active[0] != element[0]) {
			$.panelslider.close(function() {
				_slideIn(element, options)
			})
		} else {
			if (!active.length || active.is(":hidden")) {
				_slideIn(element, options)
			}
		}
	};
	$.panelslider.close = function(callback) {
		var active = $(".ps-active-panel"), duration = active.data("duration"), panelWidth = active
				.outerWidth(true), bodyAnimation = {}, panelAnimation = {};
		if (!active.length || active.is(":hidden") || _sliding) {
			return
		}
		_sliding = true;
		switch (active.data("side")) {
		case "left":
			bodyAnimation["margin-left"] = "-=" + panelWidth;
			panelAnimation.left = "-=" + panelWidth;
			break;
		case "right":
			bodyAnimation["margin-left"] = "+=" + panelWidth;
			panelAnimation.right = "-=" + panelWidth;
			break
		}
		active.animate(panelAnimation, duration);
		$body.animate(bodyAnimation, duration, function() {
			active.hide();
			active.removeClass("ps-active-panel");
			_sliding = false;
			if (callback) {
				callback()
			}
		})
	};
	$(document).bind("click keyup", function(e) {
		var active = $(".ps-active-panel");
		if (e.type == "keyup" && e.keyCode != 27) {
			return
		}
		if (active.is(":visible") && active.data("clickClose")) {
			$.panelslider.close()
		}
	});
	$(document).on("click", ".ps-active-panel", function(e) {
		e.stopPropagation()
	});
	$.fn.panelslider = function(options) {
		if (options.open == "true") {
			var panel1 = $("#" + options.id);
			$.panelslider(panel1, options);
		}
		this.click(function(e) {
			var active = $(".ps-active-panel"), panel = $(this
					.getAttribute("href"));
			if (active.is(":visible") && panel[0] == active[0]) {
				$.panelslider.close();
				$("#"+options.menuSpan).removeClass('glyphicon glyphicon-chevron-left');
				$("#"+options.menuSpan).addClass('glyphicon glyphicon-chevron-right');
			} else {
				$.panelslider(panel, options);
				$("#"+options.menuSpan).removeClass('glyphicon glyphicon-chevron-right');
				$("#"+options.menuSpan).addClass('glyphicon glyphicon-chevron-left');
			}
			e.preventDefault();
			e.stopPropagation()
		});
		return this
	}
})(jQuery);